<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swim Check - OSI Motivational Times Lookup</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        /* Custom styles */
        .time-value {
            font-family: 'Courier New', monospace;
            text-align: center;
        }

        .button-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .button-group button {
            flex: 1;
            min-width: 80px;
        }

        /* Reduce padding for gender and course type buttons to prevent wrapping */
        #genderButtons button,
        #courseButtons button {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
            min-width: 60px;
        }

        .button-group button.active {
            background-color: var(--pico-primary-background);
            border-color: var(--pico-primary-border);
        }

        .event-grid {
            overflow-x: auto;
            margin-bottom: 2rem;
        }

        .event-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .event-table th,
        .event-table td {
            padding: 0.5rem;
            border: 1px solid var(--pico-muted-border-color);
        }

        .event-table th {
            text-align: center;
            background-color: var(--pico-background-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .event-table td {
            text-align: center;
        }

        .event-table td:first-child {
            text-align: left;
            font-weight: 500;
        }

        .time-input {
            width: 100%;
            min-width: 120px;
            font-family: 'Courier New', monospace;
            text-align: center;
            padding: 0.5rem;
            margin: 0;
            transition: all 0.3s ease;
        }

        .time-input.invalid {
            border: 2px solid #dc3545;
        }

        /* Input border colors when standards are met */
        tr.has-value.met-a .time-input {
            border: 3px solid #28a745;
        }

        tr.has-value.met-b-plus .time-input {
            border: 3px solid #17a2b8;
        }

        tr.has-value.met-b .time-input {
            border: 3px solid #ffc107;
        }

        /* Row with entered value gets light gray background on all cells */
        .event-table tr.has-value td {
            background-color: rgba(128, 128, 128, 0.15);
            transition: background-color 0.3s ease;
        }

        /* Row with invalid standard gets light yellow background on all cells */
        .event-table tr.has-invalid-standard td {
            background-color: #fff9e6;
            transition: background-color 0.3s ease;
        }

        /* Standard cells */
        .standard-cell {
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
        }

        /* Highlight standards when met - these override the row gray background */
        .standard-cell.met {
            font-weight: 700;
            border-width: 2px;
        }

        .standard-cell.met-a {
            background-color: #28a745 !important;
            color: white;
            border-color: #1e7e34;
        }

        .standard-cell.met-b-plus {
            background-color: #17a2b8 !important;
            color: white;
            border-color: #117a8b;
        }

        .standard-cell.met-b {
            background-color: #ffc107 !important;
            color: #856404;
            border-color: #d39e00;
        }

        .app-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .season-info {
            font-size: 0.9rem;
            color: var(--pico-muted-color);
            margin-bottom: 2rem;
        }

        select {
            margin-bottom: 1rem;
        }

        .note-text {
            font-size: 0.85rem;
            font-style: italic;
            color: var(--pico-muted-color);
            margin-top: 0.5rem;
        }

        .clear-section {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--pico-muted-border-color);
        }

        /* Footer */
        .app-footer {
            text-align: center;
            margin-top: 1rem;
            padding: 2rem 0 1rem 0;
            border-top: 1px solid var(--pico-muted-border-color);
            color: var(--pico-muted-color);
            font-size: 0.9rem;
        }

        .footer-phrase {
            margin-bottom: 1.5rem;
        }

        .footer-phrase .heart {
            color: #dc3545;
        }

        .footer-support {
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }

        .footer-support a {
            color: var(--pico-primary);
            text-decoration: none;
        }

        .footer-support a:hover {
            text-decoration: underline;
        }

        .footer-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

    </style>
    <script data-goatcounter="https://ironprogrammer.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
    <script defer src="https://cloud.umami.is/script.js" data-website-id="405f9ef9-9a18-4ad2-9051-2fc5fd905872"></script>
</head>
<body>
    <main class="container">
        <div class="app-header">
            <h1>Swim Check üèä</h1>
            <h4>Motivational Times Lookup</h4>
            <p class="season-info" id="seasonInfo">Loading...</p>
        </div>

        <!-- Controls Section -->
        <section>
            <label for="ageGroupSelect">Age Group</label>
            <select id="ageGroupSelect" aria-label="Select age group">
                <option value="">Select Age Group</option>
            </select>

            <label>Gender</label>
            <div class="button-group" id="genderButtons" role="group" aria-label="Select gender">
            </div>

            <label>Course Type</label>
            <div class="button-group" id="courseButtons" role="group" aria-label="Select course type">
                <button type="button" class="secondary" data-course="SCY">SCY</button>
                <button type="button" class="secondary" data-course="SCM">SCM</button>
                <button type="button" class="secondary" data-course="LCM">LCM</button>
            </div>

            <div id="noteDisplay" class="note-text"></div>
        </section>

        <!-- Event Grid Section -->
        <section class="event-grid">
            <div id="eventsContainer">
                <p style="text-align: center; color: var(--pico-muted-color);">
                    Please select age group, gender, and course type to view events.
                </p>
            </div>
        </section>

        <!-- Clear Times Section -->
        <section class="clear-section">
            <label style="margin: 1rem auto; display: block;">
                <input type="checkbox" id="fastEntryToggle" role="switch" />
                Fast entry mode (numbers only)
            </label>
            <button type="button" id="clearTimesBtn" class="secondary">Clear All Times</button>
            <p class="note-text" style="margin-bottom: 1rem;">
                üí° Tip: Rotate your phone to landscape view for better table visibility.
            </p>
            <p class="note-text" style="margin-bottom: 1rem;">
                Times marked with ‚ö†Ô∏è indicate source data issues or unexpected time progressions
                (<a href="https://github.com/ironprogrammer/swimcheck" target="_blank" rel="noopener noreferrer">more details on GitHub</a>).
            </p>
        </section>

        <!-- Clear Times Confirmation Modal -->
        <dialog id="clearTimesModal">
            <article>
                <header>
                    <button aria-label="Close" rel="prev" id="closeModalBtn"></button>
                    <p><strong>Clear All Times?</strong></p>
                </header>
                <p>
                    Are you sure you want to clear all entered times? This cannot be undone.
                </p>
                <footer>
                    <button type="button" class="secondary" id="cancelClearBtn">Cancel</button>
                    <button type="button" id="confirmClearBtn">Clear All Times</button>
                </footer>
            </article>
        </dialog>

        <!-- Footer -->
        <footer class="app-footer">
            <p class="footer-phrase" id="footerPhrase">Made with <span class="heart">‚ù§Ô∏è</span> in war-torn PDX</p>
            <div class="footer-support">
                <p><strong>Do you find Swim Check useful?</strong><br>Consider <a href="https://github.com/ironprogrammer/swimcheck" target="_blank" rel="noopener noreferrer">contributing on GitHub</a> or buying me a coffee! (aka helping pay for meet fees)</p>
            </div>
            <div class="footer-buttons">
                <a href="https://www.buymeacoffee.com/ironprogrammer" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a>
            </div>
        </footer>
    </main>

    <script>
        // Constants
        const CURRENT_DATA_VERSION = 2;

        // App state
        let swimData = null;
        let appState = {
            ageGroup: null,
            gender: null,
            courseType: 'SCY',
            times: {},
            dataVersion: CURRENT_DATA_VERSION,
            fastEntryMode: false
        };

        // Load JSON data
        async function loadData() {
            try {
                // Try local file first
                let response = await fetch('swim_time_standards.json');

                // If local file doesn't exist, fall back to swimcheck.org
                if (!response.ok) {
                    response = await fetch('https://swimcheck.org/swim_time_standards.json');
                }

                swimData = await response.json();
                document.getElementById('seasonInfo').textContent = swimData.title;
                initializeApp();
            } catch (error) {
                console.error('Failed to load swim data:', error);
                document.getElementById('seasonInfo').textContent = 'Error loading data';
            }
        }

        // Initialize the app
        function initializeApp() {
            loadStateFromStorage();
            populateAgeGroups();
            populateGenderButtons();
            setupEventListeners();
            renderEvents();
        }

        // Local storage functions
        function saveStateToStorage() {
            localStorage.setItem('swimCheckState', JSON.stringify(appState));
        }

        function loadStateFromStorage() {
            const saved = localStorage.getItem('swimCheckState');
            if (saved) {
                const parsed = JSON.parse(saved);
                // Merge parsed data, but only use default dataVersion if parsed doesn't have one
                appState = {
                    ...appState,
                    ...parsed,
                    dataVersion: parsed.dataVersion // Explicitly use parsed version (could be undefined)
                };
                migrateOldTimeKeys();
            }
        }

        // Migrate old time keys from AGE_GENDER_COURSE_EVENT to GENDER_COURSE_EVENT format
        function migrateOldTimeKeys() {
            // Skip if already at current version or higher
            if (appState.dataVersion >= CURRENT_DATA_VERSION) {
                return;
            }

            // Data version is old (or missing), perform migration
            if (!appState.times || Object.keys(appState.times).length === 0) {
                // No times to migrate, just update version
                appState.dataVersion = CURRENT_DATA_VERSION;
                saveStateToStorage();
                return;
            }

            const newTimes = {};
            let migrated = false;

            for (const [key, value] of Object.entries(appState.times)) {
                // Count underscores to detect old format (3 underscores = 4 parts)
                const underscoreCount = (key.match(/_/g) || []).length;

                if (underscoreCount === 3) {
                    // Old format: AGE_GENDER_COURSE_EVENT
                    const parts = key.split('_');
                    const newKey = parts.slice(1).join('_'); // Remove first part (age)
                    newTimes[newKey] = value;
                    migrated = true;
                } else {
                    // Already new format or keep as-is
                    newTimes[key] = value;
                }
            }

            // Update to current version
            appState.times = newTimes;
            appState.dataVersion = CURRENT_DATA_VERSION;
            saveStateToStorage();

            if (migrated) {
                console.log(`Migrated time keys to new format (v${CURRENT_DATA_VERSION})`);
            }
        }

        // Populate age groups dropdown
        function populateAgeGroups() {
            const select = document.getElementById('ageGroupSelect');
            swimData.ageGroups.forEach(group => {
                const option = document.createElement('option');
                option.value = group.age;
                option.textContent = group.age;
                select.appendChild(option);
            });

            if (appState.ageGroup) {
                select.value = appState.ageGroup;
            }
        }

        // Populate gender buttons
        function populateGenderButtons() {
            const container = document.getElementById('genderButtons');
            const genders = new Set();

            swimData.ageGroups.forEach(group => {
                Object.keys(group.genders).forEach(gender => genders.add(gender));
            });

            genders.forEach(gender => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'secondary';
                button.textContent = gender;
                button.dataset.gender = gender;
                if (appState.gender === gender) {
                    button.classList.add('active');
                    button.classList.remove('secondary');
                }
                container.appendChild(button);
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Age group selection
            document.getElementById('ageGroupSelect').addEventListener('change', (e) => {
                appState.ageGroup = e.target.value;
                saveStateToStorage();
                renderEvents();
            });

            // Gender buttons
            document.getElementById('genderButtons').addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    document.querySelectorAll('#genderButtons button').forEach(btn => {
                        btn.classList.remove('active');
                        btn.classList.add('secondary');
                    });
                    e.target.classList.add('active');
                    e.target.classList.remove('secondary');
                    appState.gender = e.target.dataset.gender;
                    saveStateToStorage();
                    renderEvents();
                }
            });

            // Course type buttons
            document.getElementById('courseButtons').addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    document.querySelectorAll('#courseButtons button').forEach(btn => {
                        btn.classList.remove('active');
                        btn.classList.add('secondary');
                    });
                    e.target.classList.add('active');
                    e.target.classList.remove('secondary');
                    appState.courseType = e.target.dataset.course;
                    saveStateToStorage();
                    renderEvents();
                }
            });

            // Set initial course button active state
            if (appState.courseType) {
                const courseBtn = document.querySelector(`[data-course="${appState.courseType}"]`);
                if (courseBtn) {
                    courseBtn.classList.add('active');
                    courseBtn.classList.remove('secondary');
                }
            }

            // Fast entry mode toggle
            const fastEntryToggle = document.getElementById('fastEntryToggle');
            fastEntryToggle.checked = appState.fastEntryMode;
            fastEntryToggle.addEventListener('change', (e) => {
                appState.fastEntryMode = e.target.checked;
                saveStateToStorage();

                // Update inputmode on all existing time inputs
                document.querySelectorAll('.time-input').forEach(input => {
                    if (appState.fastEntryMode) {
                        input.setAttribute('inputmode', 'numeric');
                    } else {
                        input.removeAttribute('inputmode');
                    }
                });
            });

            // Clear times button - show modal
            document.getElementById('clearTimesBtn').addEventListener('click', () => {
                document.getElementById('clearTimesModal').showModal();
            });

            // Modal close button
            document.getElementById('closeModalBtn').addEventListener('click', () => {
                document.getElementById('clearTimesModal').close();
            });

            // Modal cancel button
            document.getElementById('cancelClearBtn').addEventListener('click', () => {
                document.getElementById('clearTimesModal').close();
            });

            // Modal confirm button
            document.getElementById('confirmClearBtn').addEventListener('click', () => {
                appState.times = {};
                saveStateToStorage();
                renderEvents();
                document.getElementById('clearTimesModal').close();
            });
        }

        // Render events table
        function renderEvents() {
            const container = document.getElementById('eventsContainer');
            const noteDisplay = document.getElementById('noteDisplay');
            noteDisplay.textContent = '';

            if (!appState.ageGroup || !appState.gender || !appState.courseType) {
                container.innerHTML = '<p style="text-align: center; color: var(--pico-muted-color);">Please select age group, gender, and course type to view events.</p>';
                return;
            }

            const ageGroupData = swimData.ageGroups.find(g => g.age === appState.ageGroup);
            if (!ageGroupData || !ageGroupData.genders[appState.gender]) {
                container.innerHTML = '<p style="text-align: center; color: var(--pico-muted-color);">No events found for selected criteria.</p>';
                return;
            }

            // Display note if exists
            if (ageGroupData.note) {
                noteDisplay.textContent = ageGroupData.note;
            }

            const events = ageGroupData.genders[appState.gender].events;
            const course = appState.courseType;

            let tableHTML = `
                <table class="event-table">
                    <thead>
                        <tr>
                            <th>Event</th>
                            <th>Time</th>
                            <th>A</th>
                            <th>B+</th>
                            <th>B</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            events.forEach((event, index) => {
                const times = event[course];

                // Skip events with no times for this course
                if (!times || (times.A === null && times['B+'] === null && times.B === null)) {
                    return;
                }

                const eventKey = `${appState.gender}_${course}_${event.name}`;
                const userTime = appState.times[eventKey] || '';
                const qualification = userTime ? getQualification(userTime, times) : null;

                // Add 'has-value' class to row if user has entered a time
                // Add met class to row for input border styling
                let rowClass = userTime ? 'has-value' : '';

                // Add 'has-invalid-standard' class if any standard has warning emoji
                if (hasInvalidStandard(times)) {
                    rowClass += ' has-invalid-standard';
                }

                if (qualification === 'a') {
                    rowClass += ' met-a';
                } else if (qualification === 'b-plus') {
                    rowClass += ' met-b-plus';
                } else if (qualification === 'b') {
                    rowClass += ' met-b';
                }

                // Determine standard cell classes
                const aClass = qualification === 'a' ? 'standard-cell met met-a' : 'standard-cell';
                const bPlusClass = qualification === 'b-plus' ? 'standard-cell met met-b-plus' : 'standard-cell';
                const bClass = qualification === 'b' ? 'standard-cell met met-b' : 'standard-cell';

                const inputModeAttr = appState.fastEntryMode ? 'inputmode="numeric"' : '';

                tableHTML += `
                    <tr class="${rowClass}">
                        <td>${event.name}</td>
                        <td>
                            <input
                                type="text"
                                class="time-input"
                                ${inputModeAttr}
                                placeholder="mm:ss.ms"
                                data-event-key="${eventKey}"
                                value="${userTime}"
                                aria-label="Enter time for ${event.name}"
                            >
                        </td>
                        <td class="${aClass} time-value" data-standard="a" data-event-key="${eventKey}">
                            ${times.A || 'n/a'}
                        </td>
                        <td class="${bPlusClass} time-value" data-standard="b-plus" data-event-key="${eventKey}">
                            ${times['B+'] || 'n/a'}
                        </td>
                        <td class="${bClass} time-value" data-standard="b" data-event-key="${eventKey}">
                            ${times.B || 'n/a'}
                        </td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;

            // Setup time input handlers
            setupTimeInputHandlers();
        }

        // Setup time input event handlers
        function setupTimeInputHandlers() {
            const inputs = document.querySelectorAll('.time-input');

            inputs.forEach(input => {
                let timeout;

                // Auto-select text on focus for easier replacement
                input.addEventListener('focus', (e) => {
                    e.target.select();

                    // Prevent mouseup from repositioning cursor after select
                    const preventMouseUp = (event) => {
                        event.preventDefault();
                        e.target.removeEventListener('mouseup', preventMouseUp);
                    };
                    e.target.addEventListener('mouseup', preventMouseUp, { once: true });
                });

                input.addEventListener('input', (e) => {
                    // Real-time validation feedback
                    const value = e.target.value.trim();
                    if (value && !isValidTimeInput(value)) {
                        e.target.classList.add('invalid');
                    } else {
                        e.target.classList.remove('invalid');
                    }

                    clearTimeout(timeout);
                    timeout = setTimeout(() => {
                        handleTimeInput(e.target);
                    }, 500);
                });

                input.addEventListener('blur', (e) => {
                    clearTimeout(timeout);
                    handleTimeInput(e.target);
                });
            });
        }

        // Validate time input contains only valid characters
        function isValidTimeInput(value) {
            if (!value) return true;
            return /^[0-9:.]+$/.test(value);
        }

        // Parse time input: strip non-digits, parse right-to-left to mm:ss.xx format
        function parseTimeInput(value) {
            if (!value) return '';

            // Strip all non-digits and leading zeros
            let digits = value.replace(/\D/g, '');
            digits = digits.replace(/^0+/, '') || '0'; // Remove leading zeros, keep at least one digit
            if (digits.length === 0) return '';

            const len = digits.length;

            if (len === 1) {
                // Single digit: "5" ‚Üí "00.05"
                return `00.0${digits}`;
            } else if (len === 2) {
                // Two digits: "34" ‚Üí "00.34"
                return `00.${digits}`;
            } else if (len === 3) {
                // Three digits: "123" ‚Üí "01.23"
                return `0${digits[0]}.${digits.slice(1)}`;
            } else if (len === 4) {
                // Four digits: "1234" ‚Üí "12.34"
                return `${digits.slice(0, 2)}.${digits.slice(2)}`;
            } else {
                // Five or more digits: "12345" ‚Üí "1:23.45", "123456" ‚Üí "12:34.56"
                const hundredths = digits.slice(-2);
                const seconds = digits.slice(-4, -2);
                const minutes = digits.slice(0, -4);
                return `${minutes}:${seconds}.${hundredths}`;
            }
        }

        // Handle time input
        function handleTimeInput(input) {
            const eventKey = input.dataset.eventKey;
            const value = input.value.trim();

            // Check for invalid characters
            if (value && !isValidTimeInput(value)) {
                input.classList.add('invalid');
                delete appState.times[eventKey];
                saveStateToStorage();
                updateStandardHighlighting(input);
                return;
            }

            // Remove invalid class if present
            input.classList.remove('invalid');

            // Parse and format the time
            const parsedTime = parseTimeInput(value);

            // Enforce max length of 9 characters (e.g., "190:38.98")
            const finalTime = parsedTime.substring(0, 9);

            if (finalTime) {
                appState.times[eventKey] = finalTime;
                input.value = finalTime;
            } else {
                delete appState.times[eventKey];
            }

            saveStateToStorage();
            updateStandardHighlighting(input);
        }

        // Update standard cell highlighting
        function updateStandardHighlighting(input) {
            const eventKey = input.dataset.eventKey;
            const value = input.value.trim();

            // Find the row
            const row = input.closest('tr');

            // Get all standard cells in this row
            const standardCells = row.querySelectorAll('.standard-cell');

            // Remove all highlight classes from standard cells
            standardCells.forEach(cell => {
                cell.classList.remove('met', 'met-a', 'met-b-plus', 'met-b');
            });

            // Remove qualification classes from row
            row.classList.remove('met-a', 'met-b-plus', 'met-b');

            // Add or remove 'has-value' class on row based on input
            if (value) {
                row.classList.add('has-value');
            } else {
                row.classList.remove('has-value');
                return;
            }

            // Skip comparison if input is invalid
            if (input.classList.contains('invalid')) {
                return;
            }

            // Find the event's times
            const [gender, course, eventName] = eventKey.split('_');
            const ageGroupData = swimData.ageGroups.find(g => g.age === appState.ageGroup);
            if (!ageGroupData) return;

            const event = ageGroupData.genders[gender].events.find(e => e.name === eventName);
            if (!event) return;

            const times = event[course];
            const qualification = getQualification(value, times);

            // Highlight the appropriate standard cell (if any)
            // Row already has light gray background from 'has-value' class
            if (qualification === 'a') {
                const aCell = Array.from(standardCells).find(cell => cell.dataset.standard === 'a');
                if (aCell) {
                    aCell.classList.add('met', 'met-a');
                }
                row.classList.add('met-a');
            } else if (qualification === 'b-plus') {
                const bPlusCell = Array.from(standardCells).find(cell => cell.dataset.standard === 'b-plus');
                if (bPlusCell) {
                    bPlusCell.classList.add('met', 'met-b-plus');
                }
                row.classList.add('met-b-plus');
            } else if (qualification === 'b') {
                const bCell = Array.from(standardCells).find(cell => cell.dataset.standard === 'b');
                if (bCell) {
                    bCell.classList.add('met', 'met-b');
                }
                row.classList.add('met-b');
            }
            // If qualification === 'none', just the row gray background shows (no cell highlighting)
        }

        // Get qualification level (returns 'a', 'b-plus', 'b', or 'none')
        function getQualification(userTime, standards) {
            const userSeconds = timeToSeconds(userTime);
            if (userSeconds === null) return null;

            // Skip standards with warning emoji (invalid data)
            const aTime = (standards.A && !standards.A.includes('‚ö†Ô∏è')) ? timeToSeconds(standards.A) : null;
            const bPlusTime = (standards['B+'] && !standards['B+'].includes('‚ö†Ô∏è')) ? timeToSeconds(standards['B+']) : null;
            const bTime = (standards.B && !standards.B.includes('‚ö†Ô∏è')) ? timeToSeconds(standards.B) : null;

            // Lower times are better in swimming
            if (aTime !== null && userSeconds <= aTime) {
                return 'a';
            } else if (bPlusTime !== null && userSeconds <= bPlusTime) {
                return 'b-plus';
            } else if (bTime !== null && userSeconds <= bTime) {
                return 'b';
            } else {
                return 'none';
            }
        }

        // Check if any standard has invalid data (contains warning emoji)
        function hasInvalidStandard(times) {
            return (times.A && times.A.includes('‚ö†Ô∏è')) ||
                   (times['B+'] && times['B+'].includes('‚ö†Ô∏è')) ||
                   (times.B && times.B.includes('‚ö†Ô∏è'));
        }

        // Convert time string to seconds
        function timeToSeconds(timeStr) {
            if (!timeStr) return null;

            // Strip non-time characters (only allow numerics, ':', and '.')
            timeStr = timeStr.trim().replace(/[^0-9:.]/g, '');

            // Format: MM:SS.MS or SS.MS
            const parts = timeStr.split(':');
            let minutes = 0;
            let seconds = 0;

            if (parts.length === 2) {
                // MM:SS.MS format
                minutes = parseFloat(parts[0]) || 0;
                seconds = parseFloat(parts[1]) || 0;
            } else if (parts.length === 1) {
                // SS.MS format
                seconds = parseFloat(parts[0]) || 0;
            } else {
                return null;
            }

            return minutes * 60 + seconds;
        }

        // Random footer phrases
        function setRandomFooterPhrase() {
            const phrases = [
                'Made with <span class="heart">‚ù§Ô∏è</span> in war-torn PDX',
                'Made with <span class="heart">‚ù§Ô∏è</span> while PDX is aflame',
                'Built with <span class="heart">‚ù§Ô∏è</span> and the bravery to venture into the rough streets of PDX',
                'Made with <span class="heart">‚ù§Ô∏è</span> between pickleball games in war-ravaged PDX',
                'Crafted with <span class="heart">‚ù§Ô∏è</span> from the front lines of PDX',
                'Freshly brewed with <span class="heart">‚ù§Ô∏è</span> and Courier Coffee',
                'Finely tuned with <span class="heart">‚ù§Ô∏è</span> and Blue Star donuts',
                'Bravely coded with <span class="heart">‚ù§Ô∏è</span> from the epicenter of the PDX war zone',
                'Banged out with <span class="heart">‚ù§Ô∏è</span> and used gear from Revival Drums PDX',
                'Shamelessly sponsored with <span class="heart">‚ù§Ô∏è</span> by [YOUR COMPANY HERE]'
            ];

            const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
            const footerElement = document.getElementById('footerPhrase');
            if (footerElement) {
                footerElement.innerHTML = randomPhrase;
            }
        }

        // Initialize app on load
        loadData();
        setRandomFooterPhrase();
    </script>
</body>
</html>
